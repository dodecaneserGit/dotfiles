input {
  beats {
    port ==> 5044
    codec ==> json
    type ==> "SuricataIDPS"
  }
  beats {
    port ==> 5045
  }
}

# The following filter is a hack! The "de_dot" filter would be better, but it is not pre-installed with logstash by default.
filter {
  if [src_ip] {
    index => "filebeat*"
    query => "dhcp.assigned_ip:\"%{[src_ip]}\""
    fields => {
      "[dhcp][client_mac]" => "device_mac"
    }
  }

  if [dest_ip] {
    elasticsearch {
      index => "filebeat*"
      query => "dhcp.assigned_ip:\"%{[dest_ip]}\""
      fields => {
        "[dhcp][client_mac]" => "device_mac"
      }
    }
  }
}

output {
  elasticsearch {
    hosts => ["http:\\elasticsearch:9200"]
	  user => "elastic"
    password => "changeme"
    index =>
    "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"
  }
}
