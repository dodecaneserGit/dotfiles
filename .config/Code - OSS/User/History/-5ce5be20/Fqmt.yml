version: "3.9"

services:

networks:
  elastic:
    driver: bridge

volumes:
  elastic-data:

elasticsearch:
  container_name: elasticsearch
  image: docker.elastic.co/elasticsearch/elasticsearch:8.6.0-arm64
  ports:
    - 9200:9200
    - 9300:9300
  environment:
    - discovery.type=single-node
    - PUID=1001
    - PGID=1001
    - ELASTIC_PASSWORD=1980Matrix77
    - xpack.monitoring.enabled=true
    - xpack.watcher.enabled=false
    - xpack.security.enabled=false
    - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  ulimits:
      memlock:
        soft: -1
        hard: -1
  #cap_add:
  #  - ALL
  volumes:
    - ./SIEM/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
    - elastic-data:/usr/share/elasticsearch/data
  restart: unless-stopped
  networks:
    elastic:

kibana:
  depends_on:
    - elasticsearch
  image: docker.elastic.co/kibana/kibana:
  container_name: kibana
  volumes:
    - kibana-data:/usr/share/kibana/data
  ports:
    - ${KIBANA_PORT}:5601
  restart: always
  environment:
    - ELASTICSEARCH_HOSTS=http://elasticsearch:9200

