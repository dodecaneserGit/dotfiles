version: "3.9"

services:

networks:
  elastic:
    driver: bridge

volumes:
  elastic-data:
  kibana-data:

elasticsearch:
  container_name: elasticsearch
  image: docker.elastic.co/elasticsearch/elasticsearch:8.6.0-arm64
  ports:
    - 9200:9200
    - 9300:9300
  environment:
    - discovery.type=single-node
    - PUID=1001
    - PGID=1001
    - ELASTIC_PASSWORD=1980Matrix77
    - xpack.watcher.enabled=false
    - xpack.security.enabled=true #Optional
    - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
  ulimits:
      memlock:
        soft: -1
        hard: -1
  #cap_add:
  #  - ALL
  volumes:
    #- ./SIEM/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml
    - elastic-data:/usr/share/elasticsearch/data
  restart: always
  networks:
    elastic:

kibana:
  depends_on:
    - elasticsearch
  image: docker.elastic.co/kibana/kibana:8.6.0-arm64
  container_name: kibana
  volumes:
    - kibana-data:/usr/share/kibana/data
  ports:
    - 5601:5601
  restart: always
  environment:
    - ELASTICSEARCH_HOSTS=http://elasticsearch:9200

filebeat:
  depends_on:
    - elasticsearch
  image: docker.elastic.co/beats/filebeat-oss:8.6.0-arm64
  container_name: filebeat
  user: root
  volumes:
    - ./filebeat.yml://usr/share/filebeat/filebeat.yml:ro
    - /var/lib/docker/containers:/var/lib/docker/containers:ro
    - /var/run/docker.sock:/var/run/docker.sock:ro
  environment:
    - output.elasticsearch.hosts=["elasticsearch:9200"]
  


